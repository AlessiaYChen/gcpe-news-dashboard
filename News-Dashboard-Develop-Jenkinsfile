node('master') {



  stage('Assembling frontend') {
		openshift.withCluster() {
			openshift.withProject() {
			  echo "Assembling frontend..."
				def bc3 = openshift.selector('bc', 'news-dashboard-develop')
				def buildSelector3 = bc3.startBuild()
        sleep(5)
				buildSelector3.logs('-f')
				sleep(30)
			}
		}
  }

  stage('Inject into runtime') {
		openshift.withCluster() {
			openshift.withProject() {
			  echo "Inject into runtime..."
				def bc4 = openshift.selector('bc', 'news-dashboard-static')
				def buildSelector4 = bc4.startBuild('')
        sleep(30)
				buildSelector4.logs('-f')
				sleep(30)
			}
		}
  }


  stage('Tag Build') {
		openshift.withCluster() {
			openshift.withProject() {
			  echo "Tagging build..."
        openshift.tag("news-dashboard-static:latest", "news-dashboard-static:DEVELOP-$BUILD_ID")
        openshift.tag("news-dashboard-static:DEVELOP-$BUILD_ID", "news-dashboard-static:dev")
			  openshift.tag("news-dashboard-static:DEVELOP-$BUILD_ID", "news-dashboard-static:test")
			}
		}
  }

  stage('Deploy on Dev') {
		openshift.withCluster() {
      openshift.withProject("05e933-dev") {
		    echo "Deploying to dev..."
			  openshift.selector("dc", "news-dashboard").rollout().latest()
		  }
		}
	}
  stage('Deploy on Test') {
      input "Deploy to test?"
      openshift.withCluster() {
        openshift.withProject("05e933-test") {
          openshift.selector("dc", "news-dashboard").rollout().latest()
        }
      }
    }
}
